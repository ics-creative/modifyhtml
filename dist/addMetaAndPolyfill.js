#!/usr/bin/env node
!function(t){var e={};function n(o){if(e[o])return e[o].exports;var i=e[o]={i:o,l:!1,exports:{}};return t[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=t,n.c=e,n.d=function(t,e,o){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(o,i,function(e){return t[e]}.bind(null,i));return o},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=2)}([function(t,e){t.exports=require("fs")},function(t,e){t.exports=require("path")},function(t,e,n){"use strict";var o=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e},i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=o(n(0)),s=o(n(1)),a=n(3),u=i(n(4)),l="addMetaAndPolyfill：";u.default.usage("-src path_to_target").option("--src <value>","対象フォルダー").option("--polyfill <value>","ポリフィルのパス").parse(process.argv);const c=t=>{return!0===t.includes("X-UA-Compatible")?t:t.replace(/(\<head\>)/,'$1\n  <meta http-equiv="X-UA-Compatible" content="ie=edge"/>')},p=t=>{const e=u.default.polyfill;if(null==e||""===e)return console.log(`${l}ポリフィルの指定なし`),t;const n=`<script src="${e}" defer><\/script>`;return!0===t.includes(n)?(console.log(`${l}指定のポリフィルは設定済みです`),t):(console.log(`${l}ポリフィルを設定しました`),t.replace(/(.*<\/head>)/,`  ${n}\n$1`))};e.modifyCodes=(async t=>{for(const e of t){let t=r.readFileSync(e,"utf8");t=c(t),t=p(t),r.writeFileSync(e,t,{encoding:"utf-8"})}}),e.addMetaAndPolyfill=(()=>{console.log(`${l}IE11向けにHTMLコードを編集します`);const t=u.default.src;if("string"!=typeof t||""===t)return console.warn(`${l}対象フォルダーが設定されていません`),void console.warn(`${l}処理を終了します`);const n=`${s.resolve(process.cwd(),t)}`;if(!1===r.existsSync(n))return console.warn(`${l}対象フォルダーの「${n}」が見つかりませんでした\n    `),void console.warn(`${l}処理を終了します`);const o=a.listupFiles(n);e.modifyCodes(o),console.log(`${l}処理が終了しました`)}),e.addMetaAndPolyfill()},function(t,e,n){"use strict";var o=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e};Object.defineProperty(e,"__esModule",{value:!0});const i=o(n(0)),r=o(n(1));e.listupFiles=(t=>{const n=[],o=i.readdirSync(t);for(const s of o){const o=`${t}/${s}`,a=i.statSync(o);if(a.isFile()){if(".html"!==r.extname(o))continue;if("debug.html"===o)continue;n.push(o)}else a.isDirectory()&&n.push(...e.listupFiles(o))}return n})},function(t,e,n){var o=n(5).EventEmitter,i=n(6).spawn,r=n(1),s=r.dirname,a=r.basename,u=n(0);function l(t,e){this.flags=t,this.required=t.indexOf("<")>=0,this.optional=t.indexOf("[")>=0,this.bool=-1===t.indexOf("-no-"),(t=t.split(/[ ,|]+/)).length>1&&!/^[[<]/.test(t[1])&&(this.short=t.shift()),this.long=t.shift(),this.description=e||""}function c(t){this.commands=[],this.options=[],this._execs={},this._allowUnknownOption=!1,this._args=[],this._name=t||""}function p(t,e){var n=Math.max(0,e-t.length);return t+Array(n+1).join(" ")}function h(t,e){e=e||[];for(var n=0;n<e.length;n++)"--help"!==e[n]&&"-h"!==e[n]||(t.outputHelp(),process.exit(0))}function f(t){var e=t.name+(!0===t.variadic?"...":"");return t.required?"<"+e+">":"["+e+"]"}function m(t){try{if(u.statSync(t).isFile())return!0}catch(t){return!1}}n(7).inherits(c,o),(e=t.exports=new c).Command=c,e.Option=l,l.prototype.name=function(){return this.long.replace("--","").replace("no-","")},l.prototype.attributeName=function(){return this.name().split("-").reduce(function(t,e){return t+e[0].toUpperCase()+e.slice(1)})},l.prototype.is=function(t){return this.short===t||this.long===t},c.prototype.command=function(t,e,n){"object"==typeof e&&null!==e&&(n=e,e=null),n=n||{};var o=t.split(/ +/),i=new c(o.shift());return e&&(i.description(e),this.executables=!0,this._execs[i._name]=!0,n.isDefault&&(this.defaultExecutable=i._name)),i._noHelp=!!n.noHelp,this.commands.push(i),i.parseExpectedArgs(o),i.parent=this,e?this:i},c.prototype.arguments=function(t){return this.parseExpectedArgs(t.split(/ +/))},c.prototype.addImplicitHelpCommand=function(){this.command("help [cmd]","display help for [cmd]")},c.prototype.parseExpectedArgs=function(t){if(t.length){var e=this;return t.forEach(function(t){var n={required:!1,name:"",variadic:!1};switch(t[0]){case"<":n.required=!0,n.name=t.slice(1,-1);break;case"[":n.name=t.slice(1,-1)}n.name.length>3&&"..."===n.name.slice(-3)&&(n.variadic=!0,n.name=n.name.slice(0,-3)),n.name&&e._args.push(n)}),this}},c.prototype.action=function(t){var e=this,n=function(n,o){n=n||[],o=o||[];var i=e.parseOptions(o);h(e,i.unknown),i.unknown.length>0&&e.unknownOption(i.unknown[0]),i.args.length&&(n=i.args.concat(n)),e._args.forEach(function(t,o){t.required&&null==n[o]?e.missingArgument(t.name):t.variadic&&(o!==e._args.length-1&&e.variadicArgNotLast(t.name),n[o]=n.splice(o))}),e._args.length?n[e._args.length]=e:n.push(e),t.apply(e,n)},o=this.parent||this,i=o===this?"*":this._name;return o.on("command:"+i,n),this._alias&&o.on("command:"+this._alias,n),this},c.prototype.option=function(t,e,n,o){var i=this,r=new l(t,e),s=r.name(),a=r.attributeName();if("function"!=typeof n)if(n instanceof RegExp){var u=n;n=function(t,e){var n=u.exec(t);return n?n[0]:e}}else o=n,n=null;return(!r.bool||r.optional||r.required)&&(r.bool||(o=!0),void 0!==o&&(i[a]=o,r.defaultValue=o)),this.options.push(r),this.on("option:"+s,function(t){null!==t&&n&&(t=n(t,void 0===i[a]?o:i[a])),"boolean"==typeof i[a]||void 0===i[a]?i[a]=null==t?!!r.bool&&(o||!0):t:null!==t&&(i[a]=t)}),this},c.prototype.allowUnknownOption=function(t){return this._allowUnknownOption=0===arguments.length||t,this},c.prototype.parse=function(t){this.executables&&this.addImplicitHelpCommand(),this.rawArgs=t,this._name=this._name||a(t[1],".js"),this.executables&&t.length<3&&!this.defaultExecutable&&t.push("--help");var e=this.parseOptions(this.normalize(t.slice(2))),n=this.args=e.args,o=this.parseArgs(this.args,e.unknown),i=o.args[0],r=null;return i&&(r=this.commands.filter(function(t){return t.alias()===i})[0]),this._execs[i]&&"function"!=typeof this._execs[i]?this.executeSubCommand(t,n,e.unknown):r?(n[0]=r._name,this.executeSubCommand(t,n,e.unknown)):this.defaultExecutable?(n.unshift(this.defaultExecutable),this.executeSubCommand(t,n,e.unknown)):o},c.prototype.executeSubCommand=function(t,e,n){(e=e.concat(n)).length||this.help(),"help"===e[0]&&1===e.length&&this.help(),"help"===e[0]&&(e[0]=e[1],e[1]="--help");var o,l=t[1],c=a(l,r.extname(l))+"-"+e[0],p=u.lstatSync(l).isSymbolicLink()?u.readlinkSync(l):l;p!==l&&"/"!==p.charAt(0)&&(p=r.join(s(l),p)),o=s(p);var h,f=r.join(o,c),d=!1;m(f+".js")?(c=f+".js",d=!0):m(f+".ts")?(c=f+".ts",d=!0):m(f)&&(c=f),e=e.slice(1),"win32"!==process.platform?d?(e.unshift(c),e=(process.execArgv||[]).concat(e),h=i(process.argv[0],e,{stdio:"inherit",customFds:[0,1,2]})):h=i(c,e,{stdio:"inherit",customFds:[0,1,2]}):(e.unshift(c),h=i(process.execPath,e,{stdio:"inherit"}));["SIGUSR1","SIGUSR2","SIGTERM","SIGINT","SIGHUP"].forEach(function(t){process.on(t,function(){!1===h.killed&&null===h.exitCode&&h.kill(t)})}),h.on("close",process.exit.bind(process)),h.on("error",function(t){"ENOENT"===t.code?console.error("error: %s(1) does not exist, try --help",c):"EACCES"===t.code&&console.error("error: %s(1) not executable. try chmod or run with root",c),process.exit(1)}),this.runningCommand=h},c.prototype.normalize=function(t){for(var e,n,o,i=[],r=0,s=t.length;r<s;++r){if(e=t[r],r>0&&(n=this.optionFor(t[r-1])),"--"===e){i=i.concat(t.slice(r));break}n&&n.required?i.push(e):e.length>1&&"-"===e[0]&&"-"!==e[1]?e.slice(1).split("").forEach(function(t){i.push("-"+t)}):/^--/.test(e)&&~(o=e.indexOf("="))?i.push(e.slice(0,o),e.slice(o+1)):i.push(e)}return i},c.prototype.parseArgs=function(t,e){var n;return t.length?(n=t[0],this.listeners("command:"+n).length?this.emit("command:"+t.shift(),t,e):this.emit("command:*",t)):(h(this,e),e.length>0&&this.unknownOption(e[0]),0===this.commands.length&&0===this._args.filter(function(t){return t.required}).length&&this.emit("command:*")),this},c.prototype.optionFor=function(t){for(var e=0,n=this.options.length;e<n;++e)if(this.options[e].is(t))return this.options[e]},c.prototype.parseOptions=function(t){for(var e,n,o,i=[],r=t.length,s=[],a=0;a<r;++a)if(o=t[a],e)i.push(o);else if("--"!==o)if(n=this.optionFor(o))if(n.required){if(null==(o=t[++a]))return this.optionMissingArgument(n);this.emit("option:"+n.name(),o)}else n.optional?(null==(o=t[a+1])||"-"===o[0]&&"-"!==o?o=null:++a,this.emit("option:"+n.name(),o)):this.emit("option:"+n.name());else o.length>1&&"-"===o[0]?(s.push(o),a+1<t.length&&"-"!==t[a+1][0]&&s.push(t[++a])):i.push(o);else e=!0;return{args:i,unknown:s}},c.prototype.opts=function(){for(var t={},e=this.options.length,n=0;n<e;n++){var o=this.options[n].attributeName();t[o]=o===this._versionOptionName?this._version:this[o]}return t},c.prototype.missingArgument=function(t){console.error("error: missing required argument `%s'",t),process.exit(1)},c.prototype.optionMissingArgument=function(t,e){e?console.error("error: option `%s' argument missing, got `%s'",t.flags,e):console.error("error: option `%s' argument missing",t.flags),process.exit(1)},c.prototype.unknownOption=function(t){this._allowUnknownOption||(console.error("error: unknown option `%s'",t),process.exit(1))},c.prototype.variadicArgNotLast=function(t){console.error("error: variadic arguments must be last `%s'",t),process.exit(1)},c.prototype.version=function(t,e){if(0===arguments.length)return this._version;this._version=t;var n=new l(e=e||"-V, --version","output the version number");return this._versionOptionName=n.long.substr(2)||"version",this.options.push(n),this.on("option:"+this._versionOptionName,function(){process.stdout.write(t+"\n"),process.exit(0)}),this},c.prototype.description=function(t,e){return 0===arguments.length?this._description:(this._description=t,this._argsDescription=e,this)},c.prototype.alias=function(t){var e=this;if(0!==this.commands.length&&(e=this.commands[this.commands.length-1]),0===arguments.length)return e._alias;if(t===e._name)throw new Error("Command alias can't be the same as its name");return e._alias=t,this},c.prototype.usage=function(t){var e=this._args.map(function(t){return f(t)}),n="[options]"+(this.commands.length?" [command]":"")+(this._args.length?" "+e.join(" "):"");return 0===arguments.length?this._usage||n:(this._usage=t,this)},c.prototype.name=function(t){return 0===arguments.length?this._name:(this._name=t,this)},c.prototype.prepareCommands=function(){return this.commands.filter(function(t){return!t._noHelp}).map(function(t){var e=t._args.map(function(t){return f(t)}).join(" ");return[t._name+(t._alias?"|"+t._alias:"")+(t.options.length?" [options]":"")+(e?" "+e:""),t._description]})},c.prototype.largestCommandLength=function(){return this.prepareCommands().reduce(function(t,e){return Math.max(t,e[0].length)},0)},c.prototype.largestOptionLength=function(){var t=[].slice.call(this.options);return t.push({flags:"-h, --help"}),t.reduce(function(t,e){return Math.max(t,e.flags.length)},0)},c.prototype.largestArgLength=function(){return this._args.reduce(function(t,e){return Math.max(t,e.name.length)},0)},c.prototype.padWidth=function(){var t=this.largestOptionLength();return this._argsDescription&&this._args.length&&this.largestArgLength()>t&&(t=this.largestArgLength()),this.commands&&this.commands.length&&this.largestCommandLength()>t&&(t=this.largestCommandLength()),t},c.prototype.optionHelp=function(){var t=this.padWidth();return this.options.map(function(e){return p(e.flags,t)+"  "+e.description+(e.bool&&void 0!==e.defaultValue?" (default: "+JSON.stringify(e.defaultValue)+")":"")}).concat([p("-h, --help",t)+"  output usage information"]).join("\n")},c.prototype.commandHelp=function(){if(!this.commands.length)return"";var t=this.prepareCommands(),e=this.padWidth();return["Commands:",t.map(function(t){var n=t[1]?"  "+t[1]:"";return(n?p(t[0],e):t[0])+n}).join("\n").replace(/^/gm,"  "),""].join("\n")},c.prototype.helpInformation=function(){var t=[];if(this._description){t=[this._description,""];var e=this._argsDescription;if(e&&this._args.length){var n=this.padWidth();t.push("Arguments:"),t.push(""),this._args.forEach(function(o){t.push("  "+p(o.name,n)+"  "+e[o.name])}),t.push("")}}var o=this._name;this._alias&&(o=o+"|"+this._alias);var i=["Usage: "+o+" "+this.usage(),""],r=[],s=this.commandHelp();s&&(r=[s]);var a=["Options:",""+this.optionHelp().replace(/^/gm,"  "),""];return i.concat(t).concat(a).concat(r).join("\n")},c.prototype.outputHelp=function(t){t||(t=function(t){return t}),process.stdout.write(t(this.helpInformation())),this.emit("--help")},c.prototype.help=function(t){this.outputHelp(t),process.exit()}},function(t,e){t.exports=require("events")},function(t,e){t.exports=require("child_process")},function(t,e){t.exports=require("util")}]);